pipeline {
    agent any
    environment{
                GIT_NAME = sh(script: "git --no-pager show -s --format='%an'",returnStdout: true).trim()
                GIT_COMMITER_NAME = "DrissALAOUI"
    }

    stages {
        stage('Hello') {
            steps { 
                sh ' env | sort'
                sh 'echo "next line will fail the pipeline # ${GIT_NAME}"'
                sh 'unkown-command'
            }
        }
    }
    
     post {
        failure {
            sh ' env | sort'
            writeFile file: 'env.properties', text: "GIT_NAME=${GIT_NAME}"
            emailext (body: '''"Hi,

$PROJECT_NAME - Build # $BUILD_NUMBER - COMMITER # ${PROPFILE,file="env.properties",property="GIT_NAME"} - $BUILD_STATUS:

Check console output at $BUILD_URL to view the results.

Please use "Dev-team" as username/password on Jenkins !

Note - Please do not reply to this email.

Thanks,
DevOps Team."''', subject: '$PROJECT_NAME - Build # $BUILD_NUMBER - $BUILD_STATUS!', to: 'driss@abxrstudio.com')
          
        }
    }
}


