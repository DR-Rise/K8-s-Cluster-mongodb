pipeline {
    agent any

    stages {
        stage('Hello') {
            steps {
                sh ''' GIT_NAME=$(git --no-pager show -s --format='%an' $GIT_COMMIT)
                       GIT_EMAIL=$(git --no-pager show -s --format='%ae' $GIT_COMMIT)
                   '''
                sh ' env | sort'
                sh 'echo "next line will fail the pipeline"'
                sh 'unkown-command'
            }
        }
    }
    
     post {
        failure {
            emailext (body: '''Hi,

$PROJECT_NAME - Build # $BUILD_NUMBER - $BUILD_STATUS:

Check console output at $BUILD_URL to view the results.

Please use "Dev-team" as username/password on Jenkins !

Note - Please do not reply to this email.

Thanks,
DevOps Team.''', subject: '$PROJECT_NAME - Build # $BUILD_NUMBER - $BUILD_STATUS!', to: 'null')
          
        }
    }
}

env.GIT_COMMITTER_EMAIL = sh(
   script: "git --no-pager show -s --format='%ae'",
   returnStdout: true
).trim()

