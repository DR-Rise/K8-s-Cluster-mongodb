pipeline {
    agent any

    stages {
        stage('Hello') {
            steps {
                sh ' env | sort'
                sh ''' GIT_NAME=$(git --no-pager show -s --format="%an" $GIT_COMMIT)'''
                echo "GIT_NAME=\"$GIT_NAME\"" > $WORKSPACE/envvars
                sh ' env | sort'
                sh 'echo "next stage will fail the pipeline"'
            }
        }
        stage('check') {
            steps {
                echo "Commiter = ${env.GIT_NAME}"
                sh 'unkown-command'
            }
        }
    }
    
     post {
        failure {
            emailext (body: '''Hi,

$PROJECT_NAME - Build # $BUILD_NUMBER - COMMITER # ${GIT_NAME} - $BUILD_STATUS:

Check console output at $BUILD_URL to view the results.

Please use "Dev-team" as username/password on Jenkins !

Note - Please do not reply to this email.

Thanks,
DevOps Team.''', subject: '$PROJECT_NAME - Build # $BUILD_NUMBER - $BUILD_STATUS!', to: 'null')
          
        }
    }
}


