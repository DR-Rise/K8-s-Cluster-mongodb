pipeline {
    agent any
    environment {
       GIT_NAME = ''                               
   }
    stages {
        stage('Hello') {
            steps {
                sh ' env.GIT_NAME=$(git --no-pager show -s --format='%an' $GIT_COMMIT)'
                sh ' env | sort'
                sh 'echo "next stage will fail the pipeline"'
            }
        }
        stage('check') {
            steps {
                sh ' echo "Commiter = ${env.GIT_NAME}"'
                sh 'unkown-command'
            }
        }
    }
    
     post {
        failure {
            steps{
            sh ' GIT_NAME=$(git --no-pager show -s --format='%an' $GIT_COMMIT)'
            }
            emailext (body: '''Hi,

$PROJECT_NAME - Build # $BUILD_NUMBER - COMMITER # ${GIT_NAME} - $BUILD_STATUS:

Check console output at $BUILD_URL to view the results.

Please use "Dev-team" as username/password on Jenkins !

Note - Please do not reply to this email.

Thanks,
DevOps Team.''', subject: '$PROJECT_NAME - Build # $BUILD_NUMBER - $BUILD_STATUS!', to: 'null')
          
        }
    }
}


